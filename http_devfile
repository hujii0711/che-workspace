schemaVersion: 2.2.0
metadata:
  generateName: vscode-websquare
components:
  - name: tools
    container:
      image: quay.io/devfile/universal-developer-image:latest
      memoryLimit: 2Gi
      mountSources: true
      env:
        - name: DEFAULT_EXTENSIONS
          value: "/tmp/websquare-web-http-extension-1.0.0.vsix;"
      volumeMounts:
        - name: tmp
          path: /tmp
  - name: tmp
    volume:
      size: 1Gi
  - name: vscode-backend-server
    container:
      image: localhost:5000/vscode-backend-http-image:0.0.1
      command: ["/bin/sh", "-c"]
      args: ["node dist/app.js"]
      memoryLimit: 3Gi
      mountSources: true
      endpoints:
        - name: vscode-backend
          targetPort: 11199
          # 외부 접근 허용 (필요 시 internal 유지)
          exposure: public
      env:
      - name: NODE_ENV
        value: "production"
commands:
  - id: install-websquare-vsix
    exec:
      component: tools
      commandLine: |
        curl -L --fail --silent --show-error -o /tmp/websquare-web-http-extension-1.0.0.vsix https://hujii0711.github.io/savezone/websquare-web-http-extension-1.0.0.vsix || { echo "Failed to download websquare-web-http-extension-1.0.0.vsix"; exit 1; }
      group:
        kind: run
events:
  postStart:
    - install-websquare-vsix
