schemaVersion: 2.3.0
metadata:
  name: che-workspace-with-custom-vsix

# 권장: che-code 에디터 명시
editor:
  id: che-incubator/che-code/insiders/latest

components:
  # (중요) che-code 컨테이너에 DEFAULT_EXTENSIONS 주입
  - name: che-code
    container:
      # mountSources는 에디터 쪽에도 켜두는 게 안전합니다(공유 볼륨 /projects).
      mountSources: true
      env:
        - name: DEFAULT_EXTENSIONS
          value: "/projects/custom-extensions/websquare-web-extension-1.0.0.vsix"

  # VSIX 내려받는 도우미 컨테이너
  - name: tools
    container:
      image: quay.io/devfile/universal-developer-image:latest
      mountSources: true
      command: ["/bin/sh"]
      args:
        - "-c"
        - |
          # postStart에서 curl을 돌릴 거라 여기선 대기
          sleep infinity

commands:
  - id: fetch-vsix
    exec:
      component: tools
      label: "Fetch VSIX"
      workingDir: /projects
      commandLine: |
        mkdir -p /projects/custom-extensions
        curl --location --fail \
          "https://hujii0711.github.io/savezone/websquare-web-extension-1.0.0.vsix" \
          -o /projects/custom-extensions/websquare-web-extension-1.0.0.vsix

events:
  postStart:
    - fetch-vsix
